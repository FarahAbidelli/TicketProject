<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <title>HelpDesk Lite ‚Äì Nouveau Ticket</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>

    <div class="background-image"></div>

    <div class="form-container">
        <form id="ticketForm" class="ticket-form">
            <h2>Cr√©er un nouveau ticket</h2>

            <div id="message" class="hidden"></div>

            <div class="form-group">
                <label for="title">Titre du ticket</label>
                <input type="text" id="title" placeholder="Ex : Probl√®me Wi-Fi" required>
            </div>

            <div class="form-group">
                <label for="description">Description</label>
                <textarea id="description" placeholder="D√©crivez le probl√®me rencontr√©..." required></textarea>
            </div>

            <div class="form-group">
                <label for="requester">Demandeur</label>
                <input type="text" id="requester" placeholder="Ex : Farah Abidelli" required>
            </div>

            <div class="form-group">
                <label for="priority">Priorit√©</label>
                <select id="priority" required>
                    <option value="">-- S√©lectionner la priorit√© --</option>
                    <option value="haute">Haute</option>
                    <option value="moyenne">Moyenne</option>
                    <option value="basse">Basse</option>
                </select>
            </div>

            <button type="submit" class="submit-btn">‚ûï Ajouter le ticket</button>
            <a href="liste.html" class="list-btn">üìã Voir la liste des tickets</a>
        </form>
    </div>

    <script>
        document.getElementById("ticketForm").addEventListener("submit", async (e) => {
            e.preventDefault();

            const messageBox = document.getElementById("message");
            messageBox.classList.add("hidden");

            const ticket = {
                title: document.getElementById("title").value,
                description: document.getElementById("description").value,
                requester: document.getElementById("requester").value,
                priority: document.getElementById("priority").value,
                statut: "ouvert"
            };

            try {
                const response = await fetch("/api/ajouterTicket", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(ticket)
                });

                if (response.ok) {
                    messageBox.textContent = "‚úÖ Ticket ajout√© avec succ√®s !";
                    messageBox.className = "message success";
                    e.target.reset();
                } else {
                    messageBox.textContent = "‚ùå Erreur lors de l‚Äôajout du ticket.";
                    messageBox.className = "message error";
                }
            } catch (err) {
                messageBox.textContent = "‚ö†Ô∏è Erreur de connexion au serveur.";
                messageBox.className = "message error";
            }
        });
    </script>

</body>

</html>